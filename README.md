# Code repository for annotation and analysis of TEs in Vanessa butterflies

This repository contains code for TE annotation of 4 buttefly species and the subsequent analyses that have been performed.

### 01_TE_discovery_and_library_construction

De novo TE libraries for the four species were constructed independently using [RepeatModeler2] (https://github.com/Dfam-consortium/RepeatModeler), version 2.0.4 for V. cardui and V. atalanta; and version 2.0.1 for V. tameamea and A. io with LTR structural module as in `repeatmodeler.sh`. MITE families were detected and added separately using [MITE Tracker] (https://github.com/INTABiotechMJ/MITE-Tracker) pipeline [`mitetracker.sh`]. [MCHelper] (https://github.com/GonzalezLab/MCHelper) was run in automatic mode on the four TE libraries to extend fragmented consensus sequences and remove false positives based on structural criteria [`mchelper.sh`].

The resulting libraries were combined with the RepBase Arthropoda library, the Danaus plexippus TE library from Baril & Hayward, 2022 and the Leptidea sinapis library generated by Backstr√∂m lab in 2022. Satellite, tandem repeat non-coding RNA and low complexity repeat consensus sequences were removed from the standard libraries prior to that. A clustering step was produced with cd-hit-est, version 4.8.1, [`cdhit.sh`] to reduce sequence redundancy. The criteria used for collapsing two or more sequences to a single consensus were 95% identity over at least 80% of their total length. 

The collapsed (non-overlapping) versions of the annotation have been generated using `collapse_RM_annotation.py` tool from [collapse_RepeatMasker_annotaion](https://github.com/shohei-kojima/collapse_RepeatMasker_annotation).

### 02_TE_annotation

Repetitive sequences were annotated in the genomes with RepeatMasker, version 4.1.5 [`repeatmasker.sh`]. The annotation was filtered so that only the RepeatMasker hits with more than 300 of score, less than 40% divergency and more than 80 bp in length were retained in the library [`filtering_annotation.sh`].

### 03_Analyses
#### 03.1_TE_content_Figure_1
The TE composition of each genome was obtained using modified versions of `buildSummary.pl` that produce a computer readable format output. The Kimura-2-parameter (K2P) distance for each insertion was calculated using the utility calcDivergenceFromAlign.pl from RepeatMasker toolbox. All the code regarding data preprocessing for TE content analysis is located in `preprocessing.sh`. The code to generate Figure 1A is located in `TE_content_plot.R`, Figure 1B in `chromosome_masking.R` and Figure 1C in `divergence_plots.R`.

Correlation between TE content and chromosome size was tested using linear models (`lm()`) function in R. Correlations between TE content - CDS content and TE content - GC content in 10Kb genomic windows was tested in the same way.

#### 03.2_Genomic_synteny_Figure_2 [check!]
To investigate genomic rearrangements between V. cardui (as reference) and V. atalanta, V. tamemea and A. io genomes (as queries) a whole-genome alignment was performed using [minimap2](https://github.com/lh3/minimap2). We used the -x asm20 parameter recommended for alignments with up to 20% sequence divergence. The synteny was visualized using [gggenomes](https://github.com/thackl/gggenomes/).


